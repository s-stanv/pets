# CUDA Optimizers (SGD, RMSProp, Adam): GPU vs CPU

<img width="1500" height="450" alt="Figure_1" src="https://github.com/user-attachments/assets/3fc0bc71-b9e7-4e4e-9557-a444b2ac3db4" />

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–æ–≤ (SGD, RMSProp, Adam) –Ω–∞ CPU –∏ GPU (CUDA) –ø—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –ª–∏–Ω–µ–π–Ω–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –º–µ—Ç–æ–¥–æ–º –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ä–µ–¥–Ω–µ–π –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–π –æ—à–∏–±–∫–∏ (MSE).

## üìä –ß—Ç–æ –º–æ–¥–µ–ª–∏—Ä—É–µ–º

**–î–∞–Ω–Ω—ã–µ:**  
–°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è

$$
y = X w_{\text{true}} + \varepsilon,
$$

–≥–¥–µ $\varepsilon$ ‚Äî –≥–∞—É—Å—Å–æ–≤ —à—É–º —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ–º $0.1$.  

–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:  
$N = 20000$ –æ–±—ä–µ–∫—Ç–æ–≤, $D = 128$ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.

---

**–§—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å (MSE):**

$$
\mathrm{MSE}(w) = \frac{1}{N} \sum_{i=1}^{N} (x_i^{\top} w - y_i)^2
$$

**–ì—Ä–∞–¥–∏–µ–Ω—Ç:**

$$
\nabla_w \mathrm{MSE}(w) = \frac{2}{N} X^{\top}(Xw - y)
$$

---

**–û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä—ã:**

- **SGD** ‚Äî –ø–æ–ª–Ω–∞—è (batch) –≤–µ—Ä—Å–∏—è: –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≥—Ä–∞–¥–∏–µ–Ω—Ç –ø–æ –≤—Å–µ–º—É $X$.
- **RMSProp** ‚Äî —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ $(\beta_2)$, –¥–µ–ª–µ–Ω–∏–µ —à–∞–≥–∞ –Ω–∞ –∫–æ—Ä–µ–Ω—å –∏–∑ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞.
- **Adam** ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —à–∞–≥ —Å –º–æ–º–µ–Ω—Ç–∞–º–∏ –ø–µ—Ä–≤–æ–≥–æ –∏ –≤—Ç–æ—Ä–æ–≥–æ –ø–æ—Ä—è–¥–∫–æ–≤ $(\beta_1, \beta_2)$ –∏ *bias-correction*.
- **–ó–∞—â–∏—Ç–∞ –æ—Ç —á–∏—Å–ª–µ–Ω–Ω–æ–π –Ω–µ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏:** –≥–ª–æ–±–∞–ª—å–Ω—ã–π *clip* –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ (–ø–æ $L_2$-–Ω–æ—Ä–º–µ) –∏ *NaN-trap* –Ω–∞ GPU.


–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- –û–¥–∏–Ω —ç–∫—Ä–∞–Ω —Å —Ç—Ä–µ–º—è –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ (SGD, RMSProp, Adam) –≤ –æ–¥–∏–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Ä—è–¥. –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–∫–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ–∫–∞—Ä—Ç—ã (GPU) –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (CPU), –æ–ø—Ä–µ–¥–µ–ª—è–µ–º—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –û—Å–∏ X/Y –ø–æ–¥–±–∏—Ä–∞—é—Ç—Å—è –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä—É—é—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ (–º–∞—Å—à—Ç–∞–± ¬´–ø–æ —Å–≤–æ–µ–º—É —Ä–∞–∑–º–µ—Ä—É¬ª). –ü–æ –æ—Å–∏ X ‚Äî –≤—Ä–µ–º—è (–º—Å), –µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–æ–ª–±—Ü—ã time_*; –∏–Ω–∞—á–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- CUDA Toolkit 11+ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ 13.x)
- Windows + MSVC (Visual Studio 2022/2019) –∏/–∏–ª–∏ Ninja
- CMake 3.21+ (–¥–ª—è –ø—Ä–µ—Å–µ—Ç–æ–≤; –ø–æ–¥–æ–π–¥—ë—Ç –∏ 3.18+ –±–µ–∑ –ø—Ä–µ—Å–µ—Ç–æ–≤)
- Python 3 (—Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç numpy, pandas, matplotlib)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (PowerShell, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```powershell
cd CPU_vs_GPU_on_GD\scripts
./run_and_plot.ps1
```
–°–∫—Ä–∏–ø—Ç:
- –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç –≤ `CPU_vs_GPU_on_GD/build` (–ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π build –∏ –µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä);
- —Å–æ–∑–¥–∞—ë—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ `CPU_vs_GPU_on_GD/.venv` –∏ —Å—Ç–∞–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏;
- –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–∏–Ω–∞—Ä–Ω–∏–∫ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `logs/*.csv`);
- –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –æ–¥–Ω–æ –æ–∫–Ω–æ —Å —Ç—Ä–µ–º—è –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ (PNG –±–æ–ª—å—à–µ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
```powershell
./run_and_plot.ps1 -Generator Auto|Ninja|VS2022|VS2019
```

## –í–∞—Ä–∏–∞–Ω—Ç –¥–ª—è CMD
```bat
cd CPU_vs_GPU_on_GD\scripts
run_and_plot.bat
```
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π Python –∏ —Ç–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–¥–Ω–æ –æ–∫–Ω–æ —Å —Ç—Ä–µ–º—è –≥—Ä–∞—Ñ–∏–∫–∞–º–∏.

## –†—É—á–Ω–∞—è —Å–±–æ—Ä–∫–∞
Visual Studio 2022:
```bat
cd CPU_vs_GPU_on_GD
cmake -S . -B build -G "Visual Studio 17 2022" -A x64
cmake --build build --config Release --parallel
build\Release\cuda_optimizers.exe
```
Ninja:
```bat
cd CPU_vs_GPU_on_GD
cmake -S . -B build -G Ninja -DCMAKE_BUILD_TYPE=Release
cmake --build build --parallel
build\cuda_optimizers.exe
```

## –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤—Ä—É—á–Ω—É—é
```bat
cd CPU_vs_GPU_on_GD
python scripts\plots_convergence.py --logs build\Release\logs
```
- –§–ª–∞–≥ `--save` —Å–æ—Ö—Ä–∞–Ω–∏—Ç –æ–¥–∏–Ω PNG `convergence_all.png` –≤–º–µ—Å—Ç–æ –ø–æ–∫–∞–∑–∞ –æ–∫–Ω–∞.
- –ü–∞—Ä–∞–º–µ—Ç—Ä `--metric loss|excess` –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –º–µ—Ç—Ä–∏–∫—É –ø–æ –æ—Å–∏ Y.

## –ì–¥–µ –∏—Å–∫–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
- –õ–æ–≥–∏: `build/Release/logs` (CSV: `sgd.csv`, `rmsprop.csv`, `adam.csv`).
- PNG —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å —Ñ–ª–∞–≥–æ–º `--save`.

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏ –æ–≥–æ–≤–æ—Ä–∫–∏
- CUDA-—á–∞—Å—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ (–Ω–µ —Å–∏–ª—å–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ) —è–¥—Ä–∞ ‚Äî —Ü–µ–ª—å —Å—Ä–∞–≤–Ω–∏—Ç—å —Ç—Ä–µ–Ω–¥—ã, –∞ –Ω–µ –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç–∞–ª–æ–Ω–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã CUDA –∑–∞–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: `native` (CMake ‚â• 3.23) –∏–ª–∏ –Ω–∞–±–æ—Ä `75 86 89`.
- –ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ CMake —É–¥–∞–ª–∏—Ç–µ `build` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `run_and_plot.ps1` ‚Äî –æ–Ω –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±–∏–ª–¥.
